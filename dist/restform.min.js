/**
 * jquery-restform - jQuery plugin for an interactive JSON REST API console
 * @version v0.0.1
 * @link https://github.com/ecomclub/restform#readme
 * @author E-Com Club
 * @license MIT
 */
!function(t){"use strict";var c={},n=function(t){var e=t.opt,s=e.host+Restform.parseEndpoint(e.endpoint,e.params);return t.url=s},u=function(t){var e=c[t],s=e.opt,a=e.Layout;a.setTitle(s.title),a.setHost(s.host,s.endpoint),a.setUrl(n(e)),a.setMethod(s.method),a.setParams(s.params),a.setReqHeaders(s.reqHeaders),a.setResHeaders(s.resHeaders),a.setStatusCode(s.statusCode)},d=function(t,e){var s,a=c[t],n=a.opt;s=e?{res:e}:{req:n.reqBody,res:n.resBody};var o=a.bodyEditor;for(var r in o){var i=o[r];if("function"==typeof i)if(s[r])try{i(JSON.stringify(s[r],null,n.indentationSpaces))}catch(t){console.error("Invalid request body",t)}else i("")}"function"==typeof a.bodyForm&&s.req&&a.bodyForm(s.req)};t.fn.restform=function(t){var e,s,a,r=this.data("restform");r||(a=Date.now(),c[a]={opt:{title:"API Console",host:"https://api.e-com.plus/v1",endpoint:"/products/{_id}.json",method:"GET",params:[{key:"_id",value:"123",description:"Resource ID",required:!0}],reqHeaders:{"Content-Type":"application/json"},schema:null,reqBody:null,statusCode:200,resHeaders:{"Content-Type":"application/json"},resBody:null,aceTheme:"",indentationSpaces:4,chageHeadersCallback:null},liveResponse:{},url:""},r=a,s=!0);var o=c[r],i=o.opt;if("object"==typeof t&&t&&Object.assign(i,t),s){var l=Restform.layout(r);o.Layout=l,setTimeout(function(){var t={req:l.$reqBody,res:l.$resBody};for(var e in o.bodyEditor={},t){var s;if(t[e])"res"===e&&(s=!0),o.bodyEditor[e]=Restform.setupAce(t[e],s,i.aceTheme)}if(i.schema){l.$reqForm&&(o.bodyForm=Restform.setupBrutusin(l.$reqForm,i.schema));var a=Restform.setupAce(l.$schema,!0,i.aceTheme),n=JSON.stringify(i.schema,null,i.indentationSpaces);"function"==typeof a?a(n):l.$schema.html(n),window.twbschema&&l.$attributes.html(twbschema.doc(null,i.schema))}d(r)},400),l.cbSend(function(){Restform.send(o.url,i.method,i.reqHeaders,i.reqBody,function(t,e){var s,a,n,o;s=t,a=e,(o=c[n=r]).liveResponse.status=s,o.liveResponse.body=a,d(n,a),o.Layout.setStatusCode(s)})}),l.cbSwitchResponse(function(t){var e,s;s=t?(e=o.liveResponse.status,o.liveResponse.body):(e=i.statusCode,i.resBody),l.setStatusCode(e),d(r,s)}),l.cbParams(function(t){i.params=t,l.setUrl(n(o))}),l.cbHeaders(function(t){i.headers=t,"function"==typeof i.chageHeadersCallback&&i.chageHeadersCallback(t)}),e=l.$layout,o.$app=e,this.html(e),u(r)}else e=o.$app,u(r),d(r);e.fadeIn()},window.Restform={}}(jQuery),function(){"use strict";window.Restform.setupAce=function(t,e,s){if(window.ace){var a=t.attr("id"),n=ace.edit(a);return s&&""!==s||(s="dawn"),n.setTheme("ace/theme/"+s),n.session.setMode("ace/mode/json"),e&&n.setReadOnly(!0),t.click(function(){setTimeout(function(){n.focus(),n.renderer.updateFull()},200)}),function(t){n.session.setValue(t)}}return null}}(),function(){"use strict";window.Restform.setupBrutusin=function(t,e){if(window.brutusin){var s=brutusin["json-forms"].create(e),a=t[0];return function(t){s.render(a,t)}}return null}}(),function(T){"use strict";window.Restform.layout=function(b){b="restform-"+b+"-";var e=T("<h5>",{class:"restform-title"}),s=T("<span>",{class:"restform-endpoint"}),a=T("<span>",{class:"input-group-text",type:"text"}),n=T("<input>",{class:"form-control",type:"text",readonly:!0,click:function(){T(this).select()}}),o=T("<button>",{class:"btn btn-success mx-2",type:"button","aria-label":"Send",html:'<i class="ti ti-check mr-1"></i> Send'}),t=T("<nav>",{class:"fixed-top shadow-sm restform-nav",html:T("<div>",{class:"container",html:[T("<div>",{class:"row no-gutters",html:[T("<div>",{class:"col",html:T("<div>",{class:"input-group",html:[T("<div>",{class:"input-group-prepend",html:a}),n]})}),T("<div>",{class:"col-auto",html:[o,T("<button>",{class:"btn btn-light",type:"button","aria-label":"Close",html:'<i class="ti ti-close"></i>',click:function(){S.fadeOut()}})]})]})]})}),r=function(t){return T("<header>",{class:"restform-header",html:T("<div>",{class:"container",html:t})})},l=function(t,e,s){t=b+""+t;for(var a=[],n=[],o={},r={},i=0;i<e.length;i++){var l=e[i],c=t+"-pane-"+l,u=t+"-item-"+l,d={class:"nav-item nav-link",id:u,"data-toggle":"tab",href:"#"+c,role:"tab","aria-controls":c,"aria-selected":!1,text:l.charAt(0).toUpperCase()+l.slice(1)},m={class:"tab-pane fade",id:c,role:"tabpanel","aria-labelledby":u};0===i&&(d.class+=" active",d["aria-selected"]=!0,m.class+=" show active");var f=T("<div>",m);n.push(f);var p=T("<a>",d);a.push(p),r[l]=p,o[l]=f}return s||(s="nav-tabs"),{$html:[T("<nav>",{html:T("<div>",{class:"nav restform-tabs "+s,role:"tablist",id:t+"-tabs",html:a})}),T("<div>",{class:"tab-content restform-content",id:t+"-content",html:n})],$Navs:r,$Contents:o}},i=l("req",["params","body","headers","attributes"]),c=T("<section>",{id:b+"request",html:[r([e,s]),T("<div>",{class:"container",html:i.$html})]}),u=!1,d=T("<button>",{class:"btn btn-info",html:'<i class="ti-reload mr-1"></i> Switch to <b>Live</b>',click:function(){u=!u;var t=T(this).children("b");u?t.text("Sample"):t.text("Live")}});o.click(function(){u||d.click()});var m,f,p=T("<span>"),h=l("res",["body","headers"]),v=T("<section>",{id:b+"response",html:[r(T("<span>",{class:"lead",html:['<span class="mr-2">Response</span>',p]})),T("<div>",{class:"container",html:[d,T("<div>",{class:"mt-4",html:h.$html})]})]}),y=function(t){t.addClass("disabled"),t.hasClass("active")&&setTimeout(function(){t.siblings(":not(.disabled)").first().click()},200)},g=function(t,e,s,a){var n,o=t.$Navs[e],r=t.$Contents[e],i=[];if("object"==typeof s&&null!==s){var l=Object.keys(s);if(l.length){o.removeClass("disabled");for(var c=0;c<l.length;c++){var u,d,m,f=s[l[c]],p=[];if("object"==typeof f){if(u=f.key,(d=[]).push(u),m=f.value,f.required&&d.push('<span class="text-danger ml-2">required</span>'),f.description){var h=T("<a>",{class:"px-2 text-info",href:"javascript:;",html:'<i class="ti ti-help-alt"></i>',title:f.description});h.tooltip({html:!0,placement:"top"}),d.push(h)}}else m=s[d=u=l[c]];p.unshift(T("<td>",{html:T("<code>",{html:d})}),T("<td>",{html:T("<input>",{class:"form-control form-control-sm",type:"text",readonly:!!a,"data-key":u,value:m})})),i.push(T("<tr>",{html:p}))}var v=(n=i,Array.isArray(s),T("<table>",{class:"table table-striped",id:b+"params",html:[T("<tbody>",{html:n})]}));return r.html(v),v}}y(o)},$=function(t,e,s){var a,n=t.$Contents.body,o=T("<textarea>",{class:"form-control",rows:12,id:b+"body-"+e});if(s){var r=l("body-"+e,["code","form"],"nav-pills"),i=[T("<p>",{class:"small",html:['<i class="ti-help-alt mr-2 text-info"></i>',T("<a>",{href:"javascript:;",html:"Body object structure",click:function(){t.$Navs.attributes.click()}})]})].concat(r.$html);n.html(i),r.$Contents.code.html(o),a=T("<form>",{action:"javascript:;",id:b+"form-"+e}),r.$Contents.form.html(a)}else n.html(o);return{$editor:o,$form:a}},w=$(h,"res").$editor,k=$(i,"req",!0),R=k.$editor,C=k.$form,q=T("<textarea>",{id:b+"json-schema"}),x=T("<div>",{id:b+"attrs"}),j=l("schema",["list","schema"],"nav-pills");j.$Contents.list.html(x),j.$Contents.schema.html(T("<pre>",{html:q})),i.$Contents.attributes.html(j.$html);var S=T("<article>",{class:"restform",html:[t,c,v]});return{setTitle:function(t){e.text(t)},setHost:function(t,e){s.html([t,T("<strong>",{html:e.replace(/{([^}]+)}/g,"<span>$1</span>")})])},setMethod:function(t){switch(a.text(t),t){case"GET":case"DELETE":y(i.$Navs.body)}},setUrl:function(t){n.val(t)},setParams:function(t){var s=g(i,"params",t);if(s){var a=function(){if("function"==typeof m){var a=[];s.find("tr").each(function(){var t,e,s=T(this).find("input");""!==(e=1===s.length?(t=s.data("key"),s.val()):(t=s.first().val(),s.last().val()))&&""!==t&&a.push({key:t,value:e})}),m(a)}};s.find("input").change(a),s.after(T("<button>",{class:"btn btn-sm btn-light",type:"button",html:'<i class="ti ti-plus mr-1 text-primary"></i> Add a new query parameter',click:function(){var t=T("<input>",{class:"form-control form-control-sm restform-input-code","data-type":"key",type:"text",change:a}),e=T("<tr>",{html:[T("<td>",{html:T("<div>",{class:"input-group input-group-sm",html:[t,T("<div>",{class:"input-group-append",html:T("<button>",{class:"btn btn-outline-secondary",type:"button",html:'<i class="ti ti-trash"></i>',click:function(){e.remove(),a()}})})]})}),T("<td>",{html:T("<input>",{class:"form-control form-control-sm","data-type":"value",type:"text",change:a})})]});s.find("tbody").append(e),t.focus()}}))}},setReqHeaders:function(t){var e=g(i,"headers",t);e&&e.find("input").change(function(){if("function"==typeof f){var s={};e.find("input").each(function(){var t=T(this).data("key"),e=T(this).val();""!==e&&""!==t&&(s[t]=e)}),f(s)}})},setResHeaders:function(t){g(h,"headers",t,!0)},setStatusCode:function(t){var e;e=200<=t&&t<300?"success":300<=t&&t<400?"info":400<=t&&t<500?"danger":500<=t?"dark":"secondary",p.attr("class","badge badge-"+e).text(t)},cbSend:function(t){o.click(t)},cbSwitchResponse:function(t){d.click(function(){t(u)})},cbParams:function(t){m=t},cbHeaders:function(t){f=t},$reqBody:R,$reqForm:C,$resBody:w,$schema:q,$attributes:x,$layout:S}}}(jQuery),function(l){"use strict";window.Restform.send=function(t,e,s,a,n){var o={url:t,method:e,dataType:"json",contentType:"application/json; charset=UTF-8"};s&&(o.headers=s),a&&(o.data=JSON.stringify(a));var r=function(t,e){if(t){var s=t.responseJSON,a=t.status;n?n(a,s):console.log(a,s)}else e&&console.error(e)},i=l.ajax(o);return i.done(function(t,e,s){r(s)}),i.fail(function(t,e,s){r(t,s)}),i},window.Restform.parseEndpoint=function(t,e){var s,a,n=[];for(s=0;s<e.length;s++){var o=(a=e[s]).key,r=a.value;"string"==typeof r&&""!==r&&(new RegExp("{"+o+"}").test(t)?t=t.replace(new RegExp("{"+o+"}"),r):n.push(a))}if(t=t.replace(/{[^}]+}/g,""),n.length){var i="?";for(s=0;s<n.length;s++)0<s&&(i+="&"),i+=(a=n[s]).key+"="+a.value;t+=i}return t}}(jQuery);