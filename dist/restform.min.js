/**
 * jquery-restform - jQuery plugin for an interactive JSON REST API console
 * @version v1.1.0
 * @link https://github.com/ecomclub/restform#readme
 * @author E-Com Club
 * @license MIT
 */
!function(a){"use strict";var f={},o=function(t){var e=t.opt,s=e.host+Restform.parseEndpoint(e.endpoint,e.params);return t.url=s},r=function(t){var e=f[t],s=e.opt,n=e.Layout;n.setTitle(s.title),n.setHost(s.host,s.endpoint),n.setUrl(o(e)),n.setMethod(s.method),n.setParams(s.params),n.setReqHeaders(s.reqHeaders),n.setResHeaders(s.resHeaders),n.setStatusCode(s.statusCode)},m=function(t,e,s,n){var a,o=f[t],r=o.opt;if(a=e?{res:e}:{req:r.reqBody,res:r.resBody},!s){var i=o.bodyEditor;for(var c in i){var l=i[c];if("function"==typeof l)if(a[c])try{l(JSON.stringify(a[c],null,r.indentationSpaces))}catch(t){console.error("Invalid request body",t)}else l("")}}n||"function"!=typeof o.bodyForm||o.bodyForm(a.req)};a.fn.restform=function(t){var e,s,n,c=this.data("restform");c||(n=Date.now(),f[n]={opt:{title:"API Console",host:"https://api.e-com.plus/v1",endpoint:"/products/{_id}.json",method:"GET",params:[{key:"_id",value:"123",description:"Resource ID",required:!0}],reqHeaders:{"Content-Type":"application/json"},schema:null,reqBody:null,statusCode:200,resHeaders:{"Content-Type":"application/json"},resBody:null,aceTheme:"",indentationSpaces:4,chageHeadersCallback:null},liveResponse:{},url:""},c=n,s=!0);var l=f[c],u=l.opt;if("object"==typeof t&&t&&Object.assign(u,t),s){var d=Restform.layout(c);l.Layout=d,setTimeout(function(){var e=function(t,e){u.reqBody=t;var s=!!e;m(c,null,s,!s)},t=function(t){e(t,!0)},s={req:d.$reqBody,res:d.$resBody};for(var n in l.bodyEditor={},s){var a,o=s[n];if(o)"res"===n&&(a=!0),l.bodyEditor[n]=Restform.setupAce(o,a,u.aceTheme,t)}if(u.schema){d.$reqForm&&(l.bodyForm=Restform.setupBrutusin(d.$reqForm,u.schema,e));var r=Restform.setupAce(d.$schema,!0,u.aceTheme),i=JSON.stringify(u.schema,null,u.indentationSpaces);"function"==typeof r?r(i):d.$schema.html(i),window.twbschema&&d.$attributes.html(twbschema.doc(null,u.schema))}m(c)},400),d.cbSend(function(){var r=d.$loading,t=function(t,e){var s,n,a,o;s=t,n=e,(o=f[a=c]).liveResponse.status=s,o.liveResponse.body=n,m(a,n),o.Layout.setStatusCode(s),r.fadeOut("slow")};setTimeout(function(){Restform.send(l.url,u.method,u.reqHeaders,u.reqBody,t)},100),r.fadeIn()}),d.cbSwitchResponse(function(t){var e,s;s=t?(e=l.liveResponse.status,l.liveResponse.body):(e=u.statusCode,u.resBody),d.setStatusCode(e),m(c,s)}),d.cbParams(function(t){u.params=t,d.setUrl(o(l))}),d.cbHeaders(function(t){u.headers=t,"function"==typeof u.chageHeadersCallback&&u.chageHeadersCallback(t)}),setTimeout(function(){e.children("section").first().css("margin-top",e.children("nav").outerHeight())},40),e=d.$layout,l.$app=e,this.html(e),r(c)}else e=l.$app,r(c),m(c);e.fadeIn(400,function(){var t=a(document).height();e.height()<t&&e.height(t)})},window.Restform={}}(jQuery),function(){"use strict";window.Restform.setupAce=function(t,e,s,n){if(window.ace){var a=t.attr("id"),o=t.closest("section").find('[aria-controls="'+t.parent().attr("id")+'"]'),r=ace.edit(a);s&&""!==s||(s="dawn"),r.setTheme("ace/theme/"+s),r.session.setMode("ace/mode/json"),e?r.setReadOnly(!0):r.on("blur",function(){var t;try{t=JSON.parse(r.session.getValue())}catch(t){return}n(t)});var i=function(){setTimeout(function(){r.focus(),r.renderer.updateFull()},200)};return t.click(i),o.click(i),function(t){r.session.setValue(t)}}return null}}(),function(){"use strict";window.Restform.setupBrutusin=function(e,t,s){if(window.brutusin){var n=brutusin["json-forms"],a=n.create(t);n.postRender=function(t){e.find("input").change(function(){s(t.getData())})};var o=e[0];return function(t){e.html(""),Object.assign({},a).render(o,t)}}return null}}(),function(H){"use strict";window.Restform.layout=function(b){b="restform-"+b+"-";var e=H("<h5>",{class:"restform-title"}),s=H("<span>",{class:"restform-endpoint"}),n=H("<span>",{class:"input-group-text",type:"text"}),a=H("<input>",{class:"form-control",type:"text",readonly:!0,click:function(){H(this).select()}}),o=H("<button>",{class:"btn btn-success mx-2",type:"button","aria-label":"Send",html:'<i class="ti ti-check mr-1"></i> Send'}),t=H("<nav>",{class:"fixed-top shadow-sm restform-nav",html:H("<div>",{class:"container",html:[H("<div>",{class:"row no-gutters",html:[H("<div>",{class:"col",html:H("<div>",{class:"input-group",html:[H("<div>",{class:"input-group-prepend",html:n}),a]})}),H("<div>",{class:"col-auto",html:[o,H("<button>",{class:"btn btn-light",type:"button","aria-label":"Close",html:'<i class="ti ti-close"></i>',click:function(){T.fadeOut()}})]})]})]})}),r=function(t){return H("<header>",{class:"restform-header",html:H("<div>",{class:"container",html:t})})},c=function(t,e,s){t=b+""+t;for(var n=[],a=[],o={},r={},i=0;i<e.length;i++){var c=e[i],l=t+"-pane-"+c,u=t+"-item-"+c,d={class:"nav-item nav-link",id:u,"data-toggle":"tab",href:"#"+l,role:"tab","aria-controls":l,"aria-selected":!1,text:c.charAt(0).toUpperCase()+c.slice(1)},f={class:"tab-pane fade",id:l,role:"tabpanel","aria-labelledby":u};0===i&&(d.class+=" active",d["aria-selected"]=!0,f.class+=" show active");var m=H("<div>",f);a.push(m);var h=H("<a>",d);n.push(h),r[c]=h,o[c]=m}return s||(s="nav-tabs"),{$html:[H("<nav>",{html:H("<div>",{class:"nav restform-tabs "+s,role:"tablist",id:t+"-tabs",html:n})}),H("<div>",{class:"tab-content restform-content",id:t+"-content",html:a})],$Navs:r,$Contents:o}},i=c("req",["params","body","headers","attributes"]),l=H("<section>",{id:b+"request",html:[r([e,s]),H("<div>",{class:"container",html:i.$html})]}),u=!1,d=H("<button>",{class:"btn btn-info",html:'<i class="ti-reload mr-1"></i> Switch to <b>Live</b>',click:function(){u=!u;var t=H(this).children("b");u?t.text("Sample"):t.text("Live")}});o.click(function(){u||d.click()});var f,m,h=H("<span>"),p=H("<div>",{class:"restform-loading",html:H("<div>",{html:H("<div>",{class:"restform-spinner",html:"<div></div><div></div>"})})}),v=c("res",["body","headers"]),y=H("<section>",{id:b+"response",html:[p,r(H("<span>",{class:"lead",html:['<span class="mr-2">Response</span>',h]})),H("<div>",{class:"container",html:[d,H("<div>",{class:"mt-4",html:v.$html})]})]}),g=function(t){t.addClass("disabled"),t.hasClass("active")&&setTimeout(function(){t.siblings(":not(.disabled)").first().click()},200)},$=function(t,e,s,n){var a,o=t.$Navs[e],r=t.$Contents[e],i=[];if("object"==typeof s&&null!==s){var c=Object.keys(s);if(c.length){o.removeClass("disabled");for(var l=0;l<c.length;l++){var u,d,f,m=s[c[l]],h=[];if("object"==typeof m){if(u=m.key,(d=[]).push(u),f=m.value,m.required&&d.push('<span class="text-danger ml-2">required</span>'),m.description){var p=H("<a>",{class:"px-2 text-info",href:"javascript:;",html:'<i class="ti ti-help-alt"></i>',title:m.description});p.tooltip({html:!0,placement:"top",container:r}),d.push(p)}}else f=s[d=u=c[l]];h.unshift(H("<td>",{html:H("<code>",{html:d})}),H("<td>",{html:H("<input>",{class:"form-control form-control-sm",type:"text",readonly:!!n,"data-key":u,value:f})})),i.push(H("<tr>",{html:h}))}var v=(a=i,Array.isArray(s),H("<table>",{class:"table table-striped",id:b+"params",html:[H("<tbody>",{html:a})]}));return r.html(v),v}}g(o)},w=function(t,e,s){var n,a=t.$Contents.body,o=H("<textarea>",{class:"form-control",rows:12,id:b+"body-"+e});if(s){var r=c("body-"+e,["code","form"],"nav-pills"),i=[H("<p>",{class:"small",html:['<i class="ti-help-alt mr-2 text-info"></i>',H("<a>",{href:"javascript:;",html:"Body object structure",click:function(){t.$Navs.attributes.click()}})]})].concat(r.$html);a.html(i),r.$Contents.code.html(o),n=H("<form>",{action:"javascript:;",id:b+"form-"+e}),r.$Contents.form.html(n)}else a.html(o);return{$editor:o,$form:n}},k=w(v,"res").$editor,R=w(i,"req",!0),C=R.$editor,q=R.$form,x=H("<textarea>",{id:b+"json-schema"}),j=H("<div>",{id:b+"attrs"}),S=c("schema",["list","schema"],"nav-pills");S.$Contents.list.html(j),S.$Contents.schema.html(H("<pre>",{html:x})),i.$Contents.attributes.html(S.$html);var T=H("<article>",{class:"restform",html:[t,l,y]});return{setTitle:function(t){e.text(t)},setHost:function(t,e){s.html([t,H("<strong>",{html:e.replace(/{([^}]+)}/g,"<span>$1</span>")})])},setMethod:function(t){switch(n.text(t),t){case"GET":case"DELETE":g(i.$Navs.body)}},setUrl:function(t){a.val(t)},setParams:function(t){var s=$(i,"params",t);if(s){var n=function(){if("function"==typeof f){var n=[];s.find("tr").each(function(){var t,e,s=H(this).find("input");""!==(e=1===s.length?(t=s.data("key"),s.val()):(t=s.first().val(),s.last().val()))&&""!==t&&n.push({key:t,value:e})}),f(n)}};s.find("input").change(n),s.after(H("<button>",{class:"btn btn-sm btn-light",type:"button",html:'<i class="ti ti-plus mr-1 text-primary"></i> Add a new query parameter',click:function(){var t=H("<input>",{class:"form-control form-control-sm restform-input-code","data-type":"key",type:"text",change:n}),e=H("<tr>",{html:[H("<td>",{html:H("<div>",{class:"input-group input-group-sm",html:[t,H("<div>",{class:"input-group-append",html:H("<button>",{class:"btn btn-outline-secondary",type:"button",html:'<i class="ti ti-trash"></i>',click:function(){e.remove(),n()}})})]})}),H("<td>",{html:H("<input>",{class:"form-control form-control-sm","data-type":"value",type:"text",change:n})})]});s.find("tbody").append(e),t.focus()}}))}},setReqHeaders:function(t){var e=$(i,"headers",t);e&&e.find("input").change(function(){if("function"==typeof m){var s={};e.find("input").each(function(){var t=H(this).data("key"),e=H(this).val();""!==e&&""!==t&&(s[t]=e)}),m(s)}})},setResHeaders:function(t){$(v,"headers",t,!0)},setStatusCode:function(t){var e;e=200<=t&&t<300?"success":300<=t&&t<400?"info":400<=t&&t<500?"danger":500<=t?"dark":"secondary",h.attr("class","badge badge-"+e).text(t)},cbSend:function(t){o.click(t)},cbSwitchResponse:function(t){d.click(function(){t(u)})},cbParams:function(t){f=t},cbHeaders:function(t){m=t},$reqBody:C,$reqForm:q,$resBody:k,$schema:x,$attributes:j,$loading:p,$layout:T}}}(jQuery),function(c){"use strict";window.Restform.send=function(t,e,s,n,a){var o={url:t,method:e,dataType:"json",contentType:"application/json; charset=UTF-8"};s&&(o.headers=s),n&&(o.data=JSON.stringify(n));var r=function(t,e){if(t){var s=t.responseJSON,n=t.status;a?a(n,s):console.log(n,s)}else e&&console.error(e)},i=c.ajax(o);return i.done(function(t,e,s){r(s)}),i.fail(function(t,e,s){r(t,s)}),i},window.Restform.parseEndpoint=function(t,e){var s,n,a=[];for(s=0;s<e.length;s++){var o=(n=e[s]).key,r=n.value;"string"==typeof r&&""!==r&&(new RegExp("{"+o+"}").test(t)?t=t.replace(new RegExp("{"+o+"}"),r):a.push(n))}if(t=t.replace(/{[^}]+}/g,""),a.length){var i="?";for(s=0;s<a.length;s++)0<s&&(i+="&"),i+=(n=a[s]).key+"="+n.value;t+=i}return t}}(jQuery);