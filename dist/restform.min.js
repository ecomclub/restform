/**
 * jquery-restform - jQuery plugin for an interactive JSON REST API console
 * @version v1.0.0
 * @link https://github.com/ecomclub/restform#readme
 * @author E-Com Club
 * @license MIT
 */
!function(t){"use strict";var d={},n=function(t){var e=t.opt,s=e.host+Restform.parseEndpoint(e.endpoint,e.params);return t.url=s},r=function(t){var e=d[t],s=e.opt,a=e.Layout;a.setTitle(s.title),a.setHost(s.host,s.endpoint),a.setUrl(n(e)),a.setMethod(s.method),a.setParams(s.params),a.setReqHeaders(s.reqHeaders),a.setResHeaders(s.resHeaders),a.setStatusCode(s.statusCode)},u=function(t,e){var s,a=d[t],n=a.opt;s=e?{res:e}:{req:n.reqBody,res:n.resBody};var o=a.bodyEditor;for(var r in o){var i=o[r];if("function"==typeof i)if(s[r])try{i(JSON.stringify(s[r],null,n.indentationSpaces))}catch(t){console.error("Invalid request body",t)}else i("")}"function"==typeof a.bodyForm&&s.req&&a.bodyForm(s.req)};t.fn.restform=function(t){var e,s,a,i=this.data("restform");i||(a=Date.now(),d[a]={opt:{title:"API Console",host:"https://api.e-com.plus/v1",endpoint:"/products/{_id}.json",method:"GET",params:[{key:"_id",value:"123",description:"Resource ID",required:!0}],reqHeaders:{"Content-Type":"application/json"},schema:null,reqBody:null,statusCode:200,resHeaders:{"Content-Type":"application/json"},resBody:null,aceTheme:"",indentationSpaces:4,chageHeadersCallback:null},liveResponse:{},url:""},i=a,s=!0);var o=d[i],l=o.opt;if("object"==typeof t&&t&&Object.assign(l,t),s){var c=Restform.layout(i);o.Layout=c,setTimeout(function(){var t={req:c.$reqBody,res:c.$resBody};for(var e in o.bodyEditor={},t){var s;if(t[e])"res"===e&&(s=!0),o.bodyEditor[e]=Restform.setupAce(t[e],s,l.aceTheme)}if(l.schema){c.$reqForm&&(o.bodyForm=Restform.setupBrutusin(c.$reqForm,l.schema));var a=Restform.setupAce(c.$schema,!0,l.aceTheme),n=JSON.stringify(l.schema,null,l.indentationSpaces);"function"==typeof a?a(n):c.$schema.html(n),window.twbschema&&c.$attributes.html(twbschema.doc(null,l.schema))}u(i)},400),c.cbSend(function(){var r=c.$loading;Restform.send(o.url,l.method,l.reqHeaders,l.reqBody,function(t,e){var s,a,n,o;s=t,a=e,(o=d[n=i]).liveResponse.status=s,o.liveResponse.body=a,u(n,a),o.Layout.setStatusCode(s),r.fadeOut("slow")}),r.fadeIn()}),c.cbSwitchResponse(function(t){var e,s;s=t?(e=o.liveResponse.status,o.liveResponse.body):(e=l.statusCode,l.resBody),c.setStatusCode(e),u(i,s)}),c.cbParams(function(t){l.params=t,c.setUrl(n(o))}),c.cbHeaders(function(t){l.headers=t,"function"==typeof l.chageHeadersCallback&&l.chageHeadersCallback(t)}),e=c.$layout,o.$app=e,this.html(e),r(i)}else e=o.$app,r(i),u(i);e.fadeIn()},window.Restform={}}(jQuery),function(){"use strict";window.Restform.setupAce=function(t,e,s){if(window.ace){var a=t.attr("id"),n=ace.edit(a);return s&&""!==s||(s="dawn"),n.setTheme("ace/theme/"+s),n.session.setMode("ace/mode/json"),e&&n.setReadOnly(!0),t.click(function(){setTimeout(function(){n.focus(),n.renderer.updateFull()},200)}),function(t){n.session.setValue(t)}}return null}}(),function(){"use strict";window.Restform.setupBrutusin=function(t,e){if(window.brutusin){var s=brutusin["json-forms"].create(e),a=t[0];return function(t){s.render(a,t)}}return null}}(),function(H){"use strict";window.Restform.layout=function(b){b="restform-"+b+"-";var e=H("<h5>",{class:"restform-title"}),s=H("<span>",{class:"restform-endpoint"}),a=H("<span>",{class:"input-group-text",type:"text"}),n=H("<input>",{class:"form-control",type:"text",readonly:!0,click:function(){H(this).select()}}),o=H("<button>",{class:"btn btn-success mx-2",type:"button","aria-label":"Send",html:'<i class="ti ti-check mr-1"></i> Send'}),t=H("<nav>",{class:"fixed-top shadow-sm restform-nav",html:H("<div>",{class:"container",html:[H("<div>",{class:"row no-gutters",html:[H("<div>",{class:"col",html:H("<div>",{class:"input-group",html:[H("<div>",{class:"input-group-prepend",html:a}),n]})}),H("<div>",{class:"col-auto",html:[o,H("<button>",{class:"btn btn-light",type:"button","aria-label":"Close",html:'<i class="ti ti-close"></i>',click:function(){T.fadeOut()}})]})]})]})}),r=function(t){return H("<header>",{class:"restform-header",html:H("<div>",{class:"container",html:t})})},l=function(t,e,s){t=b+""+t;for(var a=[],n=[],o={},r={},i=0;i<e.length;i++){var l=e[i],c=t+"-pane-"+l,d=t+"-item-"+l,u={class:"nav-item nav-link",id:d,"data-toggle":"tab",href:"#"+c,role:"tab","aria-controls":c,"aria-selected":!1,text:l.charAt(0).toUpperCase()+l.slice(1)},m={class:"tab-pane fade",id:c,role:"tabpanel","aria-labelledby":d};0===i&&(u.class+=" active",u["aria-selected"]=!0,m.class+=" show active");var f=H("<div>",m);n.push(f);var p=H("<a>",u);a.push(p),r[l]=p,o[l]=f}return s||(s="nav-tabs"),{$html:[H("<nav>",{html:H("<div>",{class:"nav restform-tabs "+s,role:"tablist",id:t+"-tabs",html:a})}),H("<div>",{class:"tab-content restform-content",id:t+"-content",html:n})],$Navs:r,$Contents:o}},i=l("req",["params","body","headers","attributes"]),c=H("<section>",{id:b+"request",html:[r([e,s]),H("<div>",{class:"container",html:i.$html})]}),d=!1,u=H("<button>",{class:"btn btn-info",html:'<i class="ti-reload mr-1"></i> Switch to <b>Live</b>',click:function(){d=!d;var t=H(this).children("b");d?t.text("Sample"):t.text("Live")}});o.click(function(){d||u.click()});var m,f,p=H("<span>"),h=H("<div>",{class:"restform-loading",html:H("<div>",{html:H("<div>",{class:"restform-spinner",html:"<div></div><div></div>"})})}),v=l("res",["body","headers"]),y=H("<section>",{id:b+"response",html:[h,r(H("<span>",{class:"lead",html:['<span class="mr-2">Response</span>',p]})),H("<div>",{class:"container",html:[u,H("<div>",{class:"mt-4",html:v.$html})]})]}),g=function(t){t.addClass("disabled"),t.hasClass("active")&&setTimeout(function(){t.siblings(":not(.disabled)").first().click()},200)},$=function(t,e,s,a){var n,o=t.$Navs[e],r=t.$Contents[e],i=[];if("object"==typeof s&&null!==s){var l=Object.keys(s);if(l.length){o.removeClass("disabled");for(var c=0;c<l.length;c++){var d,u,m,f=s[l[c]],p=[];if("object"==typeof f){if(d=f.key,(u=[]).push(d),m=f.value,f.required&&u.push('<span class="text-danger ml-2">required</span>'),f.description){var h=H("<a>",{class:"px-2 text-info",href:"javascript:;",html:'<i class="ti ti-help-alt"></i>',title:f.description});h.tooltip({html:!0,placement:"top"}),u.push(h)}}else m=s[u=d=l[c]];p.unshift(H("<td>",{html:H("<code>",{html:u})}),H("<td>",{html:H("<input>",{class:"form-control form-control-sm",type:"text",readonly:!!a,"data-key":d,value:m})})),i.push(H("<tr>",{html:p}))}var v=(n=i,Array.isArray(s),H("<table>",{class:"table table-striped",id:b+"params",html:[H("<tbody>",{html:n})]}));return r.html(v),v}}g(o)},w=function(t,e,s){var a,n=t.$Contents.body,o=H("<textarea>",{class:"form-control",rows:12,id:b+"body-"+e});if(s){var r=l("body-"+e,["code","form"],"nav-pills"),i=[H("<p>",{class:"small",html:['<i class="ti-help-alt mr-2 text-info"></i>',H("<a>",{href:"javascript:;",html:"Body object structure",click:function(){t.$Navs.attributes.click()}})]})].concat(r.$html);n.html(i),r.$Contents.code.html(o),a=H("<form>",{action:"javascript:;",id:b+"form-"+e}),r.$Contents.form.html(a)}else n.html(o);return{$editor:o,$form:a}},k=w(v,"res").$editor,R=w(i,"req",!0),C=R.$editor,q=R.$form,x=H("<textarea>",{id:b+"json-schema"}),j=H("<div>",{id:b+"attrs"}),S=l("schema",["list","schema"],"nav-pills");S.$Contents.list.html(j),S.$Contents.schema.html(H("<pre>",{html:x})),i.$Contents.attributes.html(S.$html);var T=H("<article>",{class:"restform",html:[t,c,y]});return{setTitle:function(t){e.text(t)},setHost:function(t,e){s.html([t,H("<strong>",{html:e.replace(/{([^}]+)}/g,"<span>$1</span>")})])},setMethod:function(t){switch(a.text(t),t){case"GET":case"DELETE":g(i.$Navs.body)}},setUrl:function(t){n.val(t)},setParams:function(t){var s=$(i,"params",t);if(s){var a=function(){if("function"==typeof m){var a=[];s.find("tr").each(function(){var t,e,s=H(this).find("input");""!==(e=1===s.length?(t=s.data("key"),s.val()):(t=s.first().val(),s.last().val()))&&""!==t&&a.push({key:t,value:e})}),m(a)}};s.find("input").change(a),s.after(H("<button>",{class:"btn btn-sm btn-light",type:"button",html:'<i class="ti ti-plus mr-1 text-primary"></i> Add a new query parameter',click:function(){var t=H("<input>",{class:"form-control form-control-sm restform-input-code","data-type":"key",type:"text",change:a}),e=H("<tr>",{html:[H("<td>",{html:H("<div>",{class:"input-group input-group-sm",html:[t,H("<div>",{class:"input-group-append",html:H("<button>",{class:"btn btn-outline-secondary",type:"button",html:'<i class="ti ti-trash"></i>',click:function(){e.remove(),a()}})})]})}),H("<td>",{html:H("<input>",{class:"form-control form-control-sm","data-type":"value",type:"text",change:a})})]});s.find("tbody").append(e),t.focus()}}))}},setReqHeaders:function(t){var e=$(i,"headers",t);e&&e.find("input").change(function(){if("function"==typeof f){var s={};e.find("input").each(function(){var t=H(this).data("key"),e=H(this).val();""!==e&&""!==t&&(s[t]=e)}),f(s)}})},setResHeaders:function(t){$(v,"headers",t,!0)},setStatusCode:function(t){var e;e=200<=t&&t<300?"success":300<=t&&t<400?"info":400<=t&&t<500?"danger":500<=t?"dark":"secondary",p.attr("class","badge badge-"+e).text(t)},cbSend:function(t){o.click(t)},cbSwitchResponse:function(t){u.click(function(){t(d)})},cbParams:function(t){m=t},cbHeaders:function(t){f=t},$reqBody:C,$reqForm:q,$resBody:k,$schema:x,$attributes:j,$loading:h,$layout:T}}}(jQuery),function(l){"use strict";window.Restform.send=function(t,e,s,a,n){var o={url:t,method:e,dataType:"json",contentType:"application/json; charset=UTF-8"};s&&(o.headers=s),a&&(o.data=JSON.stringify(a));var r=function(t,e){if(t){var s=t.responseJSON,a=t.status;n?n(a,s):console.log(a,s)}else e&&console.error(e)},i=l.ajax(o);return i.done(function(t,e,s){r(s)}),i.fail(function(t,e,s){r(t,s)}),i},window.Restform.parseEndpoint=function(t,e){var s,a,n=[];for(s=0;s<e.length;s++){var o=(a=e[s]).key,r=a.value;"string"==typeof r&&""!==r&&(new RegExp("{"+o+"}").test(t)?t=t.replace(new RegExp("{"+o+"}"),r):n.push(a))}if(t=t.replace(/{[^}]+}/g,""),n.length){var i="?";for(s=0;s<n.length;s++)0<s&&(i+="&"),i+=(a=n[s]).key+"="+a.value;t+=i}return t}}(jQuery);